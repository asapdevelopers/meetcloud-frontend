<style>
.row .message-list{
    border-bottom: 1px solid #f1f1f1; 
    padding-bottom:10px;  
    padding-top:10px; 
    cursor:pointer
}
.row .message-list:hover{
    background-color: gainsboro;
}
</style>
<div ng-cloak> 
    <div ng-show="!domain">
        <div class="jumbotron text-center">
            <h2 ng-show="!error">Loading...</h2>
            <h2 ng-show="error">{{error}}</h2>  
        </div>  
    </div>

    <div ng-cloak ng-show="domain">

        <div class="jumbotron text-center">
            <h2>{{domain.friendlyName}}</h2>
        </div>

        <div class="container-fluid">

            <!-- make sure video is muted so we don't play back our ound sound. -->
            <video ng-show="mediaSourceWorking && camera" id="self-video-div" style="position:absolute; width:100px; height:100px; border:1px solid black; top:5px; left:5px; cursor:pointer" muted ng-click="openFullScreen($event)"></video>            

            <div class="row" ng-show="domain.room">
                <div class="col-xs-12">                            
                    <label>Room: {{domain.room}}</label><br/>
                    <label ng-show="connected && joined" style="color:green">Connected.</label>
                    <label ng-show="connected && !joined" style="color:orange">Connected but not joined.</label>
                    <label ng-show="!connected" style="color:red">Not connected.</label><br/>
                    <label ng-show="connected && joined && !mediaSourceWorking" style="color:red">Media is not working, audio and/or video won't be sent and might not be received.</label>
                </div>
            </div>

            <div class="row">
                <div class="col-xs-12">
                    <div>
                        <h5 ng-show="joined">
                            <span ng-show="joined.duration">Call duration: {{joined.duration}}</span><br/>
                            <span ng-show="joined.cost >= 0">Cost: {{joined.cost | currency:"$": 2}}&nbsp;({{joined.costPerHour | currency:"$": 2}} / hr / user)</span><br/>
                        </h5>
                    </div>
                </div>
            </div>

            <br/>

            <div class="row">
                <div class="col-xs-10 col-sm-8 col-md-6 col-lg-4">
                    <form name="login-form" ng-submit="connect()">          
                        <div class="row form-group">                          
                            <div class="col-xs-12">
                                <label>User Name</label>
                                <input type="text" class="form-control" placeholder="Please enter a user name..." ng-model="username" ng-disabled="connected" required>
                            </div>
                        
                        </div>
                        <div ng-show="!connected">
                            <div class="row form-group" >
                                <div class="col-xs-12">            
                                    <button type="submit" class="btn btn-default" ng-disabled="!username">Connect</button>
                                </div>
                            </div>                                                  
                        </div>
                        <div class="row form-group" ng-show="connected">
                            <div class="col-xs-12">            
                                <button type="button" class="btn btn-default" ng-click="disconnect()">Disconnect</button>
                                <button type="button" class="btn btn-default" ng-click="switchMic()" ng-disabled="!mediaSourceWorking">{{mic ? 'Mic On' : 'Mic Off'}}</button>
                                <button type="button" class="btn btn-default" ng-click="switchCamera()" ng-disabled="!mediaSourceWorking" ng-show="cameraEnabled">{{camera ? 'Camera On' : 'Camera Off'}}</button>
                                <button type="button" class="btn btn-default" ng-click="changeSources()">Update Settings</button>
                                <div ng-show="rtcBrowser == 'chrome'">
                                    <br/>
                                    <button ng-show="!sharingScreen" type="button" class="btn btn-default" ng-click="shareScreen()">Share screen</button>
                                    <button ng-show="sharingScreen" type="button" class="btn btn-default" ng-click="stopShareScreen()">Stop Share Screen</button>
                                </div>
                            </div>
                        </div>
                        <div>             
                            <div class="row form-group" ng-show="videoDevices.length > 0" >
                                <div class="col-xs-12">            
                                    <label><input type="checkbox" ng-model="cameraEnabled"> Join with Video</label>
                                </div>
                            </div>                  
                            <div ng-show="audioDevices.length > 0" class="row form-group">
                                <div class="col-xs-3">
                                    <label>Mic: </label>
                                </div>
                                <div class="col-xs-9">
                                    <select ng-options="a as a.label for a in audioDevices track by a.deviceId" ng-model="selectedAudioDevice"></select>
                                </div>
                            </div>
                            <div ng-show="videoDevices.length > 0 && cameraEnabled" class="row form-group">
                                <div class="col-xs-3">
                                    <label>Cam: </label>
                                </div>
                                <div class="col-xs-9">
                                    <select ng-options="a as a.label for a in videoDevices track by a.deviceId" ng-model="selectedVideoDevice"></select>
                                </div>
                            </div>
                            <div ng-show="audioOutputDevices.length > 0" class="row form-group">
                                <div class="col-xs-3">
                                    <label>Audio: </label>
                                </div>
                                <div class="col-xs-9">
                                    <select ng-options="a as a.label for a in audioOutputDevices track by a.deviceId" ng-model="selectedAudioOutputDevice"></select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        
            <br/>
            <div class="row" ng-show="connected && joined">
                <div class="col-xs-4 col col-md-3" style="padding-right:5px;">
                    <div class="row">
                        <div class="col-xs-12">
                            <b>Users online</b>
                        </div>
                    </div>
                    <hr style="margin:0; margin-bottom:5px"/>
                    <div class="row">
                        <div class="col-xs-12" ng-show="members.length == 0">
                            No one here.
                        </div>
                    </div>
                    <div class="row" ng-repeat="m in members">
                        <div class="col-xs-12">
                            {{m.username}}
                        </div>
                    </div>
                </div>
                <div class="col-xs-8 col-md-9">
                    <div class="row">
                        <div class="col-xs-12 col-md-6 col-lg-4 text-center" ng-repeat="u in sharingWithMe" style="margin-bottom:10px">
                            <video ng-show='u.hasVideo' style="max-width:100%; max-height:100%; border:1px solid black; top:5px; left:5px; cursor:pointer" ng-click="openFullScreen($event)" id="u-{{u.id}}"></video>
                            <video ng-show='u.screen' style="max-width:100%; max-height:100%; border:1px solid black; top:5px; left:5px; cursor:pointer" ng-click="openFullScreen($event)" id="us-{{u.id}}"></video>
                            <p class="text-center"><span>{{u.username}}</span><span ng-show="!u.hasVideo && u.hasAudio">&nbsp;&nbsp;(Audio Only)</span><span ng-click="sendWakeUp(u.id)" style="color:blue; margin-left:10px; cursor:pointer">Wake up</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <br/>
            <hr/>
            <div class="row" ng-show="connected && joined">
                <div class="col-xs-12">
                    <form ng-submit="sendMessage()">
                        <div class="row" id="messages-list-holder" style="max-height: 35vh; overflow:auto">
                            <div class="col-xs-12" >
                                <div class="row" ng-repeat="m in messages.list">
                                    <div class="col-xs-12">
                                        <div class="row message-list">
                                            <div class="col-xs-12">
                                                <p><b>{{m.source}}: </b>{{m.msg}}</p>
                                                <p><small>{{m.date.fromNow()}}.</small></p>
                                            </div>
                                        </div>
                                    </div>                                
                                </div>
                            </div>
                        </div>
                        <hr/>
                        <div class="row form-group" style="padding-top:5px;">
                            <div class="col-xs-12">
                                <input type="text" class="form-control" ng-model="messages.message" required>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-xs-12">            
                                <button type="submit" class="btn btn-default" ng-disabled="!messages.message">Send</button>
                            </div>
                        </div>
                    </form>

                </div>
            </div>

        </div>
    </div>

</div>

<script type="text/ng-template" id="share-screen-plugin-modal.html">

	<div class="modal-body">
		<p>
			Failed to get screen, make sure plugin is installed.
		</p>
        <p>
            <a href="https://chrome.google.com/webstore/detail/screen-capturing/ajhifddimkapgcifgcodmmfdlknahffk" target="_blank">Click here to obtain plugin and then refresh the page.</a>
        </p>
	</div>
</script>
